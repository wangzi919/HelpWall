<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Community Help Board</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#A0E7E5", // Soft Mint Green
                        "accent": "#FFBF86", // Warm Orange
                        "background-light": "#FFFDF5", // Creamy White
                        "text-primary": "#4A4A4A",
                        "text-secondary": "#7D7D7D",
                        "note-yellow": "#FFFACD",
                        "note-blue": "#D4F1F4",
                        "note-pink": "#FFDAB9",
                    },
                    fontFamily: {
                        "display": ["Spline Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1.25rem", // 20px
                        "lg": "1.5rem", // 24px
                        "xl": "1.875rem", // 30px
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft': '0 4px 10px rgba(0, 0, 0, 0.05)',
                    }
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
            overflow: hidden; /* 防止頁面在切換時跳動 */
        }
        #map {
            height: calc(100vh - 60px - 56px);
            width: 100%;
            z-index: 5;
        }
        .leaflet-div-icon { background: transparent; border: none; }
        .map-marker-bubble {
            position: relative;
            padding: 8px 12px;
            border-radius: 1.25rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-family: "Spline Sans", sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #4A4A4A;
            white-space: nowrap;
        }
        .map-marker-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid var(--marker-color);
        }
        .user-marker {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 40px;
            width: 40px;
            border-radius: 9999px;
            background-color: #A0E7E5;
            border: 3px solid #FFFDF5;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .user-marker .material-symbols-outlined {
            color: #4A4A4A;
            font-size: 24px;
            font-variation-settings: 'FILL' 1;
        }
        .distance-tooltip {
            background-color: rgba(255, 253, 245, 0.8);
            backdrop-filter: blur(4px);
            border: none;
            border-radius: 9999px;
            color: #4A4A4A;
            font-family: "Spline Sans", sans-serif;
            font-weight: 500;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-background-light font-display">
    <div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden text-text-primary">

        <!-- App Bar -->
        <div class="sticky top-0 z-10 flex items-center justify-between bg-background-light/80 px-4 py-3 backdrop-blur-sm">
            <div class="flex size-12 shrink-0 items-center justify-start">
                <div class="aspect-square size-10 rounded-full bg-cover bg-center" 
                     style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBQYlQA11OnSNtFQvN0zcKx3cR7AxTbl7Wt9Vu2t7iPtEJIkhj0Tl0CNQN5ovPmGMTctD-_lWwr3WgURxHM6Rn-j9AIAP-HkPUPad89TSL4DhBp_tnv-6czGFxUn2JhXIOkE4MbgHOUpmKn5im4CZK2UTWhNnSOC-FtSigZk_9wSx1la6z2Qem_HHuzHNgej_o6IPBEObLDSCeNy4Jx3qfgsxFYFWpiRLEDWVonuKWGlHAC2sUcamXDybAo0dM5Nl187yd1iw8sLz7M')">
                </div>
            </div>
            <div class="flex items-center justify-center">
                <button class="flex items-center justify-center p-2 rounded-full text-text-secondary hover:bg-black/5">
                    <span class="material-symbols-outlined text-2xl">search</span>
                </button>
            </div>
            <div class="flex size-12 shrink-0 items-center justify-end">
                <button class="relative flex items-center justify-center p-2 rounded-full text-text-secondary hover:bg-black/5">
                    <span class="material-symbols-outlined text-2xl">notifications</span>
                    <span class="absolute top-1 right-1 flex h-4 w-4 items-center justify-center rounded-full bg-accent text-xs font-bold text-white">3</span>
                </button>
            </div>
        </div>

        <!-- Segmented Buttons -->
        <div class="px-4 py-2 z-10">
            <div class="flex h-12 flex-1 items-center justify-center rounded-full bg-black/5 p-1 shadow-inner">
                <label class="flex h-full grow cursor-pointer items-center justify-center overflow-hidden rounded-full px-3 has-[:checked]:bg-white has-[:checked]:shadow-soft has-[:checked]:text-text-primary text-text-secondary text-sm font-medium leading-normal transition-all">
                    <span class="truncate">Wall View</span>
                    <input checked class="invisible w-0" name="view-toggle" type="radio" value="Wall View" id="view-wall" />
                </label>
                <label class="flex h-full grow cursor-pointer items-center justify-center overflow-hidden rounded-full px-3 has-[:checked]:bg-white has-[:checked]:shadow-soft has-[:checked]:text-text-primary text-text-secondary text-sm font-medium leading-normal transition-all">
                    <span class="truncate">Map View</span>
                    <input class="invisible w-0" name="view-toggle" type="radio" value="Map View" id="view-map" />
                </label>
            </div>
        </div>

        <!-- Help Request Cards Grid -->
        <main id="wall-view-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4 pb-24 overflow-y-auto" style="height: calc(100vh - 60px - 56px);">
            <!-- Card 1 -->
            <div class="task-card flex flex-col rounded-lg bg-note-yellow p-4 shadow-soft transition-transform duration-200 ease-in-out hover:-translate-y-1 cursor-pointer" data-task-id="1" style="transform: rotate(-1.5deg);">
                <div class="w-full aspect-video rounded-lg bg-cover bg-center" data-alt="A collection of healthy green potted plants." style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAh__ENsoBIRAJjhBJcBD_pVmgD0YBJIxGQoHSuHhs012MXb0XqKdeOTeTECKeNGVMnklVWJuvV6VUwiKikP80Lvsm6y05AjDQ2gcYLqwEJjdTHSQWmMJHlBbRK9ODLn-3H1JfhYWMw8ED9hhgKJMCmBw5B1UH5pqEXoy72o3GNz5kxrJ_HkpUnQC8wB8V1tBJSgGLtVL3X2058fU_jPPBMgQSWDRYhiWJz50Sn3DvoXYrjIhghHtDANoyO7AcBiy_hh2kF8DUOjfyr')"></div>
                <div class="flex flex-col gap-1 pt-4">
                    <p class="text-text-secondary text-sm font-medium">1.5 km away</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">Water my plants this weekend</p>
                    <p class="text-text-secondary text-base leading-normal">Going away, need someone to check on my flowers.</p>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="task-card flex flex-col rounded-lg bg-note-blue p-4 shadow-soft transition-transform duration-200 ease-in-out hover:-translate-y-1 cursor-pointer" data-task-id="2" style="transform: rotate(1deg);">
                <div class="w-full aspect-video rounded-lg bg-cover bg-center" data-alt="A person carrying a small couch with difficulty." style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCdQOJLhY85OiLPaJJucryBtHg7a3OTrn-9AvfNivIdtCoIikXBasHTYbAryN90LJN1tQzR_9Ji1LicGRP1QJ45Q4ZiH47CGz5wTL2Y3jmV_EOPHB3naSTT6VDLI6cK-dhLEli2jL71QN30aGRKG0UTRHXlCoc-R0XuHq0SKfElANOBpn4kz4MuqvstpFAIflMGu1CbvsHXuzyb7VdlvvKt6HjH5_GLRsKMSWMX3za-mcFELcIiS-G8TAA3Q-NiwiYZLFtH4VQNwAx3')"></div>
                <div class="flex flex-col gap-1 pt-4">
                    <p class="text-text-secondary text-sm font-medium">2 km away</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">Help moving a small couch</p>
                    <p class="text-text-secondary text-base leading-normal">Just need an extra pair of hands for 10 minutes!</p>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="task-card flex flex-col rounded-lg bg-note-pink p-4 shadow-soft transition-transform duration-200 ease-in-out hover:-translate-y-1 cursor-pointer" data-task-id="3" style="transform: rotate(-0.8deg);">
                <div class="w-full aspect-video rounded-lg bg-cover bg-center" data-alt="A happy golden retriever on a leash, ready for a walk." style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCz1LaCxjrovJT5XFGCdwhZIoDhbd3M9IQmFg2pGXh9n6SNttDjKuUm9RaYZ0XbvN_rnvjknT_7_-OS-VCJjY5i43IR6mprMenMVTyWzH10Li86kkF51DzjSuY8hYFfnFm1an_4bk9usoiV0fvDB6M4u9aVcN1Rto_ZT34UAsojCJiOadnC6zitLozRktKUtuVsxtH7jWJ-NFSw_LRb1mdRxTcUTTexX7VyOVJOpojMQlh2TbjwEtoWT0cMhJrgaG-QUVwdYQGnWc4Z')"></div>
                <div class="flex flex-col gap-1 pt-4">
                    <p class="text-text-secondary text-sm font-medium">2.2 km away</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">Dog Walking Needed</p>
                    <p class="text-text-secondary text-base leading-normal">Friendly golden retriever needs a walk tomorrow afternoon.</p>
                </div>
            </div>

            <!-- Card 4 -->
            <div class="task-card flex flex-col rounded-lg bg-note-yellow p-4 shadow-soft transition-transform duration-200 ease-in-out hover:-translate-y-1 cursor-pointer" data-task-id="4" style="transform: rotate(1.2deg);">
                <div class="w-full aspect-video rounded-lg bg-cover bg-center" data-alt="A grocery bag full of fresh vegetables on a kitchen counter." style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuC0WRz_6NA42WOZI5-8uRr0Q_idt3y43Wl5cJ2Bc3F0VSTMFv5J_wvd0OUMp9Ab7ckEEN4SOEeuvfjw5DqAndoXhOkbM9I3Tc5w2AYcYs9m48KLlA8fnUKUOk9KYkkQuSN47uhW-5A1dnvrom_-NPKakgwbRaiQkAD4BW_-rlvAkQyzaG3l6JnYqqpJruFPxh9FMyTduKaBULyX-UpvtQfUNfHb5SeV5Q-0dBVsz2Eh-wtCpC5Ca8A4RMWOXFzvIv1-Sc44Z2zv5fUO')"></div>
                <div class="flex flex-col gap-1 pt-4">
                    <p class="text-text-secondary text-sm font-medium">500 m away</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">Pick up groceries for me</p>
                    <p class="text-text-secondary text-base leading-normal">I'm home with a cold and can't go out. List is ready!</p>
                </div>
            </div>
        </main>

        <main id="map-view-container" class="hidden">
            <div id="map"></div>
        </main>

        <div class="fixed bottom-6 right-6 z-20">
            <button class="flex h-16 w-16 items-center justify-center rounded-full bg-primary text-text-primary shadow-lg transition-transform hover:scale-105">
                <span class="material-symbols-outlined text-4xl">add</span>
            </button>
        </div>
    </div>

    <script>
        // 取得 DOM 元素
        const viewWallRadio = document.getElementById('view-wall');
        const viewMapRadio = document.getElementById('view-map');
        const wallContainer = document.getElementById('wall-view-container');
        const mapContainer = document.getElementById('map-view-container');
        const mapElement = document.getElementById('map');

        let map = null;
        let isMapInitialized = false;

        // 地圖初始化
        function initMap() {
            if (isMapInitialized) return;
            isMapInitialized = true;
            const userLatLng = L.latLng(25.0330, 121.5654);
            const requests = [
                { title: "Pick up groceries", coords: L.latLng(25.0375, 121.5650), color: "#FFFACD" },
                { title: "Water my plants", coords: L.latLng(25.0220, 121.5680), color: "#FFFACD" },
                { title: "Help moving couch", coords: L.latLng(25.0350, 121.5450), color: "#D4F1F4" },
                { title: "Dog Walking", coords: L.latLng(25.0150, 121.5600), color: "#FFDAB9" }
            ];

            map = L.map(mapElement).setView(userLatLng, 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            const userIcon = L.divIcon({
                className: '',
                html: `<div class="user-marker"><span class="material-symbols-outlined">person_pin</span></div>`,
                iconSize: [40, 40],
                iconAnchor: [20, 40]
            });
            L.marker(userLatLng, { icon: userIcon }).addTo(map);

            requests.forEach(r => {
                const html = `<div class="map-marker-bubble" style="--marker-color:${r.color};background-color:${r.color};">${r.title}</div>`;
                const icon = L.divIcon({ className: '', html, iconAnchor: [50, 45] });
                L.marker(r.coords, { icon }).addTo(map);
            });
        }

        // 切換 Wall/Map
        function handleViewChange() {
            if (viewMapRadio.checked) {
                wallContainer.classList.add('hidden');
                mapContainer.classList.remove('hidden');
                initMap();
                if (map) map.invalidateSize();
            } else {
                wallContainer.classList.remove('hidden');
                mapContainer.classList.add('hidden');
            }
        }

        viewWallRadio.addEventListener('change', handleViewChange);
        viewMapRadio.addEventListener('change', handleViewChange);
        handleViewChange();

        // 點擊任務卡片 → 導向 task_detail.html 
        document.querySelectorAll('.task-card').forEach(card => {
            card.addEventListener('click', () => {
                const id = card.getAttribute('data-task-id');
                window.location.href = `task_detail.html?id=${id}`;
            });
        });
    </script>
</body>
</html>
