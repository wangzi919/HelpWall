<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>HelpWall - A little help, right around the corner.</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#20df60",
            "background-light": "#f6f8f6",
            "background-dark": "#112116",
          },
          fontFamily: {
            "display": ["Spline Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "1rem",
            "lg": "2rem",
            "xl": "3rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    body { font-family: 'Spline Sans', sans-serif; min-height: max(884px, 100dvh); }
    .line-icon {
      width: 24px; height: 24px; background-color: #06C755;
      -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M21.2,5.7c-0.2-0.8-0.6-1.5-1.1-2.1c-0.6-0.6-1.3-1-2.1-1.2C17.2,2.1,16.4,2,12,2c-4.4,0-5.2,0.1-6,0.4c-0.8,0.2-1.5,0.6-2.1,1.1C3.3,4.2,2.9,4.9,2.7,5.7C2.4,6.5,2.3,7.3,2.3,11.7c0,4.4,0.1,5.2,0.4,6c0.2,0.8,0.6,1.5,1.1,2.1c0.6,0.6,1.3,1,2.1,1.2c0.8,0.3,1.6,0.4,6,0.4c4.4,0,5.2-0.1,6-0.4c0.8-0.2,1.5-0.6,2.1-1.1c0.6-0.6,1-1.3,1.2-2.1c0.3-0.8,0.4-1.6,0.4-6C21.7,7.3,21.6,6.5,21.2,5.7z M19.4,17.4c-0.1,0.5-0.4,1-0.7,1.3c-0.4,0.4-0.8,0.6-1.3,0.7c-0.6,0.3-1.4,0.3-5.4,0.3s-4.7,0-5.4-0.3c-0.5-0.1-1-0.4-1.3-0.7c-0.4-0.4-0.6-0.8-0.7-1.3c-0.3-0.6-0.3-1.4-0.3-5.4s0-4.7,0.3-5.4c0.1-0.5,0.4-1,0.7-1.3c0.4-0.4,0.8-0.6,1.3-0.7c0.6-0.3,1.4-0.3,5.4-0.3s4.7,0,5.4,0.3c0.5,0.1,1,0.4,1.3,0.7c0.4,0.4,0.6,0.8,0.7,1.3c0.3,0.6,0.3,1.4,0.3,5.4S19.7,16.7,19.4,17.4z M17,11.4c0-2.8-1.5-4.4-4.5-4.4H8.7v8.9h3.7c3.1,0,4.6-1.5,4.6-4.5zM15,11.4c0,1.9-0.8,2.7-2.8,2.7h-1.6V8.7h1.6C14.2,8.7,15,9.5,15,11.4z M6.8,15.9V8h-1v7.9H6.8z'/%3E%3C/svg%3E") no-repeat center;
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M21.2,5.7c-0.2-0.8-0.6-1.5-1.1-2.1c-0.6-0.6-1.3-1-2.1-1.2C17.2,2.1,16.4,2,12,2c-4.4,0-5.2,0.1-6,0.4c-0.8,0.2-1.5,0.6-2.1,1.1C3.3,4.2,2.9,4.9,2.7,5.7C2.4,6.5,2.3,7.3,2.3,11.7c0,4.4,0.1,5.2,0.4,6c0.2,0.8,0.6,1.5,1.1,2.1c0.6,0.6,1.3,1,2.1,1.2c0.8,0.3,1.6,0.4,6,0.4c4.4,0,5.2-0.1,6-0.4c0.8-0.2,1.5-0.6,2.1-1.1c0.6-0.6,1-1.3,1.2-2.1c0.3-0.8,0.4-1.6,0.4-6C21.7,7.3,21.6,6.5,21.2,5.7z M19.4,17.4c-0.1,0.5-0.4,1-0.7,1.3c-0.4,0.4-0.8,0.6-1.3,0.7c-0.6,0.3-1.4,0.3-5.4,0.3s-4.7,0-5.4-0.3c-0.5-0.1-1-0.4-1.3-0.7c-0.4-0.4-0.6-0.8-0.7-1.3c-0.3-0.6-0.3-1.4-0.3-5.4s0-4.7,0.3-5.4c0.1-0.5,0.4-1,0.7-1.3c0.4-0.4,0.8-0.6,1.3-0.7c0.6-0.3,1.4-0.3,5.4-0.3s4.7,0,5.4,0.3c0.5,0.1,1,0.4,1.3,0.7c0.4,0.4,0.6,0.8,0.7,1.3c0.3,0.6,0.3,1.4,0.3,5.4S19.7,16.7,19.4,17.4z M17,11.4c0-2.8-1.5-4.4-4.5-4.4H8.7v8.9h3.7c3.1,0,4.6-1.5,4.6-4.5zM15,11.4c0,1.9,3.7x2.7-2.8,2.7h-1.6V8.7h1.6C14.2,8.7,15,9.5,15,11.4z M6.8,15.9V8h-1v7.9H6.8z'/%3E%3C/svg%3E") no-repeat center;
    }
  </style>
</head>

<body class="font-display">
  <div class="relative flex h-auto min-h-screen w-full flex-col items-center justify-center bg-gradient-to-b from-[#B0E0E6] to-[#FFFBF5]">
    <div class="flex flex-col items-center justify-center p-4">
      <div class="w-full max-w-sm flex flex-col items-center">
        
        <!-- LOGO -->
        <div class="w-full max-w-[300px]">
          <div class="aspect-square bg-center bg-no-repeat bg-contain"
            style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDQfz3wy3rbPnDvnYqhEL4glx2Ym8tudW1fwQtW-HvRTeT0ek8C7m2bTHS22kFX0y88olcFsWr7-kPqnyYXdrxAk-nnmPB2Zv91VkiTA5HrHl17k7MRJUA_sVpxhR02ojRaP3zpYEASvHQwQN9FOK_bGxC87AdIIOT8kjKHg1lpByDFKVfQ55_2SH-6iXvwZku-Lvjg2QgG8n4zBhS3FrrzgsBC1B0r0zti7uAmdeVnH_U-R7TjGBtcyUcdiJs9bJrVRosFgZvm6Hce");'>
          </div>
        </div>

        <h1 class="text-[#1A3A3A] text-[32px] font-bold text-center pt-6 pb-3">HelpWall</h1>
        <p class="text-gray-700/80 text-base text-center pb-8">A little help, right around the corner.</p>

        <!-- main-buttons-area -->
        <div id="main-buttons-area" class="flex flex-col gap-3 w-full px-4">

          <!-- LINE Login -->
          <button id="login-btn" class="flex items-center justify-center gap-2 rounded-full h-12 px-5 bg-primary text-white font-bold shadow-md hover:bg-primary/90 transition">
            <div class="line-icon" style="background-color: white;"></div>
            <span>Login with LINE</span>
          </button>

          <!-- Email Login 切換 -->
          <button id="guest-btn" class="rounded-full h-12 px-5 bg-white border text-[#1A3A3A] font-semibold shadow-sm transition">
            Continue with Email
          </button>
        </div>

        <!-- Email Login Form -->
        <div id="email-login-container" class="w-full max-w-sm px-4 hidden">
          <form id="email-login-form" class="flex flex-col gap-3 w-full">
              <input type="email" id="auth-email" placeholder="電子郵件" required 
                    class="rounded-full h-12 px-5 border border-gray-300 focus:ring-primary focus:border-primary transition">
              <input type="password" id="auth-password" placeholder="密碼" required
                    class="rounded-full h-12 px-5 border border-gray-300 focus:ring-primary focus:border-primary transition">
              
              <button type="submit" class="flex items-center justify-center rounded-full h-12 px-5 bg-primary text-white font-bold shadow-md hover:bg-primary/90 transition">
                  登入
              </button>

              <button type="button" id="toggle-register-btn" class="text-xs text-[#1A3A3A]/70 hover:text-[#1A3A3A] transition">
                  還沒有帳號？點擊註冊
              </button>
          </form>
          <p id="auth-message" class="text-center mt-3 text-sm text-red-500"></p>
        </div>

      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // --------------------------------------------
    // Supabase Initialization
    // --------------------------------------------
    const SUPABASE_URL = 'https://zyeykllnefwvlokrecbv.supabase.co'; 
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5ZXlrbGxuZWZ3dmxva3JlY2J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNDg2MjQsImV4cCI6MjA3ODYyNDYyNH0.zTx11lXOPAdeakTXQch9OEO4c7rfhMImNaKDz4G9DIs';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // DOM 元素
    const loginBtn = document.getElementById('login-btn');
    const guestBtn = document.getElementById('guest-btn');
    const mainButtonsArea = document.getElementById('main-buttons-area');

    const emailLoginContainer = document.getElementById('email-login-container');
    const emailLoginForm = document.getElementById('email-login-form');
    const toggleRegisterBtn = document.getElementById('toggle-register-btn');
    const authMessage = document.getElementById('auth-message');

    let isRegisterMode = false;
    let isEmailFormVisible = false;

    // --------------------------------------------
    // 1. LINE Login
    // --------------------------------------------
    loginBtn.addEventListener('click', async () => {
        const { error } = await supabase.auth.signInWithOAuth({
            provider: 'line',
            options: {
                redirectTo: `${window.location.origin}/main.html`
            }
        });

        if (error) {
            alert('LINE 登入啟動失敗: ' + error.message);
        }
    });

    // --------------------------------------------
    // 2. Email Login 切換
    // --------------------------------------------
    guestBtn.addEventListener('click', () => {
        isEmailFormVisible = !isEmailFormVisible;

        if (isEmailFormVisible) {
            mainButtonsArea.classList.add('hidden');
            emailLoginContainer.classList.remove('hidden');
            guestBtn.textContent = '返回選擇登入方式';
        } else {
            emailLoginContainer.classList.add('hidden');
            mainButtonsArea.classList.remove('hidden');
            guestBtn.textContent = 'Continue with Email';
            authMessage.textContent = '';
        }
    });

    // --------------------------------------------
    // 3. 切換「登入 / 註冊」
    // --------------------------------------------
    toggleRegisterBtn.addEventListener('click', () => {
        isRegisterMode = !isRegisterMode;

        toggleRegisterBtn.textContent = isRegisterMode
            ? '已有帳號？點擊登入'
            : '還沒有帳號？點擊註冊';

        emailLoginForm.querySelector('button[type="submit"]').textContent =
            isRegisterMode ? '註冊帳號' : '登入';

        authMessage.textContent = '';
    });

    // --------------------------------------------
    // 4. Email Sign In / Sign Up
    // --------------------------------------------
    emailLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('auth-email').value;
        const password = document.getElementById('auth-password').value;

        authMessage.textContent = isRegisterMode ? '正在註冊...' : '正在登入...';

        let response;
        if (isRegisterMode) {
            response = await supabase.auth.signUp({ email, password });
        } else {
            response = await supabase.auth.signInWithPassword({ email, password });
        }

        const { data, error } = response;

        if (error) {
            authMessage.textContent = '錯誤：' + error.message;
        } else if (data.user) {
          authMessage.textContent = '登入成功！正在取得使用者資料...';

          const uid = data.user.id; // Supabase 的 auth UID

          // === 查你的資料庫的 user 資料表 ===
          const { data: profile, error: profileError } = await supabase
              .from("user")
              .select("id")
              .eq("uid", uid)
              .single();

          if (profileError) {
              authMessage.textContent = '登入成功，但取得使用者資料失敗：' + profileError.message;
              return;
          }

          // profile.id 就是你資料庫的 user_id
          const userId = profile.id;

          window.location.href = `main.html?user_id=${userId}`;
          }
    });
</script>

</body>
</html>
